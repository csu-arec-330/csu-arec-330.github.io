<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 5 Lab: Time Series Exploratory Data Analysis (EDA)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lab_01_week_01_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab_01_week_01_files/libs/quarto-html/quarto.js"></script>
<script src="lab_01_week_01_files/libs/quarto-html/popper.min.js"></script>
<script src="lab_01_week_01_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab_01_week_01_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab_01_week_01_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab_01_week_01_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab_01_week_01_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab_01_week_01_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab_01_week_01_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives">Learning Objectives</a>
  <ul class="collapse">
  <li><a href="#learning-objectives-in-r" id="toc-learning-objectives-in-r" class="nav-link" data-scroll-target="#learning-objectives-in-r">Learning Objectives in R</a></li>
  <li><a href="#learning-objectives-in-tableau" id="toc-learning-objectives-in-tableau" class="nav-link" data-scroll-target="#learning-objectives-in-tableau">Learning Objectives in Tableau</a></li>
  </ul></li>
  <li><a href="#before-you-begin" id="toc-before-you-begin" class="nav-link" data-scroll-target="#before-you-begin">Before you begin</a></li>
  <li><a href="#time-series-with-r" id="toc-time-series-with-r" class="nav-link" data-scroll-target="#time-series-with-r">Time series with R</a>
  <ul class="collapse">
  <li><a href="#importing-time-series-data" id="toc-importing-time-series-data" class="nav-link" data-scroll-target="#importing-time-series-data">Importing time series data</a></li>
  <li><a href="#handling-dates-in-r" id="toc-handling-dates-in-r" class="nav-link" data-scroll-target="#handling-dates-in-r">Handling dates in R</a>
  <ul class="collapse">
  <li><a href="#video-reading-in-time-series-data" id="toc-video-reading-in-time-series-data" class="nav-link" data-scroll-target="#video-reading-in-time-series-data">Video: Reading in Time Series Data</a></li>
  </ul></li>
  <li><a href="#accessing-data-via-api" id="toc-accessing-data-via-api" class="nav-link" data-scroll-target="#accessing-data-via-api">Accessing data via API</a>
  <ul class="collapse">
  <li><a href="#retrieving-data-via-an-api" id="toc-retrieving-data-via-an-api" class="nav-link" data-scroll-target="#retrieving-data-via-an-api">Retrieving data via an API</a></li>
  <li><a href="#video-collecting-data-via-api" id="toc-video-collecting-data-via-api" class="nav-link" data-scroll-target="#video-collecting-data-via-api">Video: Collecting Data via API</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#tableau" id="toc-tableau" class="nav-link" data-scroll-target="#tableau">Tableau</a>
  <ul class="collapse">
  <li><a href="#before-you-begin-2" id="toc-before-you-begin-2" class="nav-link" data-scroll-target="#before-you-begin-2">Before you begin</a></li>
  <li><a href="#date-functions" id="toc-date-functions" class="nav-link" data-scroll-target="#date-functions">1. Date functions</a></li>
  <li><a href="#visualize-time-series-data" id="toc-visualize-time-series-data" class="nav-link" data-scroll-target="#visualize-time-series-data">2. Visualize time series data</a></li>
  <li><a href="#creating-and-interpreting-trend-lines" id="toc-creating-and-interpreting-trend-lines" class="nav-link" data-scroll-target="#creating-and-interpreting-trend-lines">3. Creating and interpreting trend lines</a></li>
  <li><a href="#visualizing-structural-breaks" id="toc-visualizing-structural-breaks" class="nav-link" data-scroll-target="#visualizing-structural-breaks">4. Visualizing structural breaks</a></li>
  <li><a href="#creating-panes-to-visualize-mutiple-time-series" id="toc-creating-panes-to-visualize-mutiple-time-series" class="nav-link" data-scroll-target="#creating-panes-to-visualize-mutiple-time-series">5. Creating panes to visualize mutiple time series</a></li>
  <li><a href="#video-using-tableau-to-visualize-time-series-data" id="toc-video-using-tableau-to-visualize-time-series-data" class="nav-link" data-scroll-target="#video-using-tableau-to-visualize-time-series-data">Video: Using Tableau to Visualize Time Series Data</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 5 Lab: Time Series Exploratory Data Analysis (EDA)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><img src="includes/generic_forecasting.webp" class="img-fluid"></p>
<div style="font-size: 1.5em">
<p>This Lab Contributes to Course Objectives: 1, 2, 3, 4, 7, 8</p>
</div>
<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<section id="learning-objectives-in-r" class="level3">
<h3 class="anchored" data-anchor-id="learning-objectives-in-r">Learning Objectives in R</h3>
<ul>
<li>Read in time series data</li>
<li>Work with dates in R</li>
<li>Download data via API</li>
</ul>
</section>
<section id="learning-objectives-in-tableau" class="level3">
<h3 class="anchored" data-anchor-id="learning-objectives-in-tableau">Learning Objectives in Tableau</h3>
<ul>
<li>Understand and use date functions</li>
<li>Create calculated fields using date functions</li>
<li>Visualize time series data</li>
<li>Create and interpret trend lines</li>
<li>Identify and visualize structural breaks</li>
<li>Use panes to visualize multiple time series</li>
</ul>
</section>
</section>
<section id="before-you-begin" class="level1">
<h1>Before you begin</h1>
<ol type="1">
<li>Create a new sub-folder called <code>lab_05</code> under your <code>arec_330</code> folder.</li>
</ol>
<ul>
<li>This is the folder where you will save all of the files we will download during this lab.</li>
</ul>
<ol start="2" type="1">
<li><p>Open a new R script and save it as <code>lab_05_script.R</code>.</p></li>
<li><p>Add a description of the script as a comment.</p></li>
<li><p>Set your working directory as <code>arec_330/lab_05</code>.</p></li>
<li><p>Load (install if necessary) needed packages.</p></li>
</ol>
</section>
<section id="time-series-with-r" class="level1">
<h1>Time series with R</h1>
<p>The overall objective of this lab is to acquaint you with <strong>time series data.</strong></p>
<p>Time series data is widely used but lacks a standardized format. Importantly, dates and times are not inherently understood by machines—they are stored as numbers relative to a specific starting point (epoch).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<ul>
<li><strong>R Epoch:</strong> January 1, 1970</li>
<li><strong>Excel Epoch:</strong> January 1, 1900</li>
</ul>
<p>You can confirm this by running:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#epoch</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">as.Date</span>(<span class="st">"1970-01-01"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#add one day to see how dates are tracked</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">as.Date</span>(<span class="st">"1970-01-02"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<section id="importing-time-series-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-time-series-data">Importing time series data</h2>
<p>Importing time series data is similar to other types of data, but special attention is needed for date formatting.</p>
<p>We will use <a href="https://fred.stlouisfed.org/series/APU0000708111"><strong>retail egg price data</strong> from the St.&nbsp;Louis FED (FRED)</a>.</p>
<p>You can download the data manually or import it directly via <code>read_csv()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load necessary libraries</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'readr' was built under R version 4.4.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.4.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Read in the data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>egg_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://csu-arec-330.github.io/materials/unit_01/inputs/APU0000708111.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 517 Columns: 2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (1): APU0000708111
date (1): DATE

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>The <code>read_csv()</code> function will try to guess the data type. In this case, it correctly identifies the variable <code>DATE</code> as a date.</p>
<p>Review the data type of the variable directly by looking at the dataframe:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Confirm that R read in the date field as a date</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(egg_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 517
Columns: 2
$ DATE          &lt;date&gt; 1980-01-01, 1980-02-01, 1980-03-01, 1980-04-01, 1980-05…
$ APU0000708111 &lt;dbl&gt; 0.879, 0.774, 0.812, 0.797, 0.737, 0.731, 0.776, 0.907, …</code></pre>
</div>
</div>
</section>
<section id="handling-dates-in-r" class="level2">
<h2 class="anchored" data-anchor-id="handling-dates-in-r">Handling dates in R</h2>
<p>Sometimes, date fields are stored as <strong>text</strong> and need to be converted. In these cases, you need to give R some guidance.</p>
<p>To see this in practice, read in a <a href="https://csu-arec-330.github.io/materials/unit_01/inputs/APU0000708111_cdate.csv">modified version of the egg prices data</a>.</p>
<p>Assign the dataframe to an object called <code>egg_raw_c</code> to avoid overwriting the existing data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Read in the data</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>egg_raw_c <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://csu-arec-330.github.io/materials/unit_01/inputs/APU0000708111_cdate.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 517 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): CHAR_DATE
dbl (1): APU0000708111

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Confirm that R read in the date field as text and *not* a date</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(egg_raw_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 517
Columns: 2
$ APU0000708111 &lt;dbl&gt; 0.879, 0.774, 0.812, 0.797, 0.737, 0.731, 0.776, 0.907, …
$ CHAR_DATE     &lt;chr&gt; "01/01/1980", "02/01/1980", "03/01/1980", "04/01/1980", …</code></pre>
</div>
</div>
<p>Notice that the date is not recognized as a date type variable. <strong>You can verify this because <code>CHAR_DATE</code> is listed as <code>chr (1)</code>.</strong></p>
<p>Next, we need to tell R how to interpret that date. We will use functions from the <code>tidyverse</code> package, specifically the <a href="https://lubridate.tidyverse.org/index.html"><code>lubridate</code> library</a>, designed to help work with dates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The easiest way to get lubridate is to install the whole tidyverse:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively, install just lubridate:</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"lubridate"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the necessary libraries</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the mutate() function along with the mdy() function to convert the text date to a date value</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>egg_raw_c <span class="ot">&lt;-</span> <span class="fu">mutate</span>(egg_raw_c,<span class="at">measure_date=</span><span class="fu">mdy</span>(CHAR_DATE))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Confirm that you have successfully converted the variable to a date field</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(egg_raw_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, you can chain commands:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Chaining commands to produce the same data frame</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>egg_raw_c <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">measure_date=</span><span class="fu">mdy</span>(CHAR_DATE)) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="video-reading-in-time-series-data" class="level3">
<h3 class="anchored" data-anchor-id="video-reading-in-time-series-data">Video: Reading in Time Series Data</h3>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/zpTNJyiPiwE" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
</section>
<section id="accessing-data-via-api" class="level2">
<h2 class="anchored" data-anchor-id="accessing-data-via-api">Accessing data via API</h2>
<p>API stands for <strong>Application Programming Interface</strong> and they facilitate much of the communication across the modern web.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://content.altexsoft.com/media/2019/06/1.png" class="img-fluid figure-img"></p>
<figcaption>API schematic. Source: https://www.altexsoft.com/blog/engineering/what-is-api-definition-types-specifications-documentation/</figcaption>
</figure>
</div>
<p>We use APIs to query data. FRED maintains an API that can be accessed using the library <a href="https://business-science.github.io/tidyquant/"><code>tidyquant</code></a>. This library also has a large array of finance analysis tools. Right now, we will just use it to access FRED data.</p>
<section id="retrieving-data-via-an-api" class="level3">
<h3 class="anchored" data-anchor-id="retrieving-data-via-an-api">Retrieving data via an API</h3>
<p>The API we will use retrieves data from the FRED. Specifically, we will retrieve price series data, <a href="https://fred.stlouisfed.org/categories/32455">available here</a>.</p>
<section id="before-you-begin-1" class="level4">
<h4 class="anchored" data-anchor-id="before-you-begin-1">Before you begin</h4>
<p>Before you begin, explore the FRED website.</p>
<ol type="1">
<li><p>Go to https://fred.stlouisfed.org/categories/32455. What do you see?</p></li>
<li><p>Select <strong>Commodities.</strong></p></li>
<li><p>Use the <strong>Filter by</strong> navigation bar to filter concepts. Select <strong>Retail</strong>. What changes?</p></li>
<li><p>The default list of tables is sorted by popularity. Currently, the average price of eggs is the most popular. Select that table.</p></li>
</ol>
<p>Now, let’s deconstruct the image you see.</p>
<p><img src="includes/egg_series.png" class="img-fluid" style="width:80.0%"></p>
<ol type="1">
<li><p>This is the unique identifier from FRED that is specific to the data series.</p></li>
<li><p>This is the date range underlying the data series.</p></li>
<li><p>This is the actual data series, not seasonally adjusted.</p></li>
</ol>
<p>Now that we are familiar with this layout, let’s use an API to retreive the data and save it as a data frame in R.</p>
</section>
<section id="step-1-install-and-load-libraries" class="level4">
<h4 class="anchored" data-anchor-id="step-1-install-and-load-libraries">Step 1: Install and load libraries</h4>
<p>Install <code>tidyquant</code> on your machine (e.g., <code>install.packages("tidyquant")</code>) and load the library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Install the package if you have not already done so. Comment this out after you have installed it once on your machine.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyquant"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the library. The library needs to be loaded every time you begin a new instance of R.</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyquant, <span class="at">quietly =</span> <span class="cn">TRUE</span>) <span class="co">#Note: The argument quietly = T in the library() function suppresses messages that would normally be printed when loading a package.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-retrieve-time-series-data-via-tq_get" class="level4">
<h4 class="anchored" data-anchor-id="step-2-retrieve-time-series-data-via-tq_get">Step 2: Retrieve time series data via <code>tq_get()</code></h4>
<p>For this exercise, we will use the function <code>tq_get()</code> to access the FRED API.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Understanding `tq_get()` Syntax">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Understanding <code>tq_get()</code> Syntax
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The <code>tq_get()</code> function is used to retrieve time series data from sources such as FRED, stock prices, and exchange rates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="st">"symbol"</span>, </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">get =</span> <span class="st">"data_source"</span>, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">from =</span> <span class="st">"YYYY-MM-DD"</span>, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">to =</span> <span class="st">"YYYY-MM-DD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>“symbol” <span class="math inline">\(\rightarrow\)</span> The unique identifier for the data series (e.g., “AAPL” for Apple stock, “GDP” for U.S. GDP from FRED).</li>
<li><code>get</code> <span class="math inline">\(\rightarrow\)</span> The data source, such as:
<ul>
<li>“economic.data” for macroeconomic data from FRED.</li>
<li>“stock.prices” for historical stock prices.</li>
<li>“dividends” for dividend data.</li>
<li>“exchange.rates” for currency exchange rates.</li>
</ul></li>
<li><code>from</code> and <code>to</code> <span class="math inline">\(\rightarrow\)</span> Defines the date range for the retrieved data in YYYY-MM-DD format.</li>
<li><code>data</code> <span class="math inline">\(\rightarrow\)</span> The resulting dataframe containing the retrieved time series.</li>
</ul>
</div>
</div>
</div>
<p>This function can do many things so we need to be specific with some parameters:</p>
<ul>
<li><p>First, we need to find the unique identifier from FRED that points to the data we want. In this case, we are going to grab <strong>retail egg prices</strong> (the same data that we downloaded earlier). The unique identifier is <code>"APU0000708111"</code>. <strong>Remember the quotes.</strong></p></li>
<li><p>Second, the documentation tells us that to access data from FRED we need to set the <code>get</code> parameter to <code>"economic.data"</code>.</p></li>
<li><p>Third, we can specify the date range with the <code>from</code> and <code>to</code> parameters. Remember to use the YYYY-MM-DD format.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the tq_get() function to retrieve the time series data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>egg_raw_tq <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="st">"APU0000708111"</span>, <span class="co"># This is the symbol for retail egg prices</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">get =</span> <span class="st">"economic.data"</span>, <span class="co"># This is the data source</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">from=</span><span class="st">"1990-01-01"</span>, <span class="co"># This is the start of our time range</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">to=</span><span class="st">"2024-02-28"</span>) <span class="co"># This is the end of our time range</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(egg_raw_tq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-3-retrieve-multiple-time-series-data-using-tq_get" class="level4">
<h4 class="anchored" data-anchor-id="step-3-retrieve-multiple-time-series-data-using-tq_get">Step 3: Retrieve multiple time series data using <code>tq_get()</code></h4>
<p>You can download multiple time series at once by using a vector of identifiers.</p>
<p>Let’s download the <strong>producer price index</strong> to compare to the retail price of a dozen eggs. The identifier is <code>WPU017107</code>. Note that I am going to overwrite the existing object <code>egg_raw_tq</code> because I am going to download the retail price series as well as the producer price index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the tq_get() function to retrieve two time series datasets</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>egg_raw_tq <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="fu">c</span>(<span class="st">"APU0000708111"</span>,<span class="st">"WPU017107"</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">get =</span> <span class="st">"economic.data"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">from=</span><span class="st">"1990-01-01"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">to=</span><span class="st">"2024-02-28"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(egg_raw_tq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Using `c()` to Retrieve Multiple Series">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Using <code>c()</code> to Retrieve Multiple Series
</div>
</div>
<div class="callout-body-container callout-body">
<p>When retrieving multiple time series, use <code>c()</code> to pass multiple symbols into <code>tq_get()</code>. What this code does is:</p>
<ul>
<li><code>c("APU0000708111", "WPU017107")</code> <span class="math inline">\(\rightarrow\)</span> A vector containing multiple FRED series.</li>
<li>This retrieves both retail egg prices (APU0000708111) and the producer price index for eggs (WPU017107).</li>
<li>The resulting dataframe will contain stacked time series, with an identifier column (symbol) to distinguish them.</li>
</ul>
</div>
</div>
</section>
<section id="step-4-rename-variables-for-clarity" class="level4">
<h4 class="anchored" data-anchor-id="step-4-rename-variables-for-clarity">Step 4: Rename variables for clarity</h4>
<p>Notice that there are <strong>3 columns</strong> in <strong>egg_raw_tq</strong> but we downloaded two time series. Why aren’t there <strong>4 columns</strong>?</p>
<p><strong>Answer:</strong> The new data is stacked. We can confirm this a few ways:</p>
<ol type="1">
<li>Use the <code>unique()</code> function to see what values for symbol are in the dataset</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Display the unique values of the variable symbol</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(egg_raw_tq<span class="sc">$</span>symbol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Use <code>table()</code> to see the counts by each value</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Count the number of observations associated with each value of symbol</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(egg_raw_tq<span class="sc">$</span>symbol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>Why does the retail series <code>APU0000708111</code> have more observations?</p>
</blockquote>
<ol start="3" type="1">
<li>Use <code>case_when()</code> to replacing values based on a criteria</li>
</ol>
<p>The time series are currently identified by the variable <code>symbol</code>. These codes are not informative. Let’s replace them with better labels.</p>
<p>We will use the <code>case_when()</code> function in the <code>dplyr</code> package to replace the symbol with a more descriptive name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the FRED API to retrieve two data series and rename them the series with a more descriptive name</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>egg_out <span class="ot">&lt;-</span> egg_raw_tq <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">description=</span><span class="fu">case_when</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    symbol <span class="sc">==</span> <span class="st">"APU0000708111"</span> <span class="sc">~</span> <span class="st">"Egg Retail Price"</span>, <span class="co">#if symbol equals APU0000708111, then replace value with Egg Retail Price</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    symbol <span class="sc">==</span> <span class="st">"WPU017107"</span> <span class="sc">~</span> <span class="st">"Egg Producer Price"</span> <span class="co">#if symbol equals WPU017107, then replace value with Egg Producer Price</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Use <code>write_csv()</code> to write the dataset to a csv file.</li>
</ol>
<p>Now the dataset is ready for export in .csv format so you can import it into Tableau.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Write the dataset to a csv file</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(egg_prices, <span class="st">"egg_prices.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="You do it">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You do it
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Download the following data series using <code>tq_get()</code> as <strong>separate data frames</strong>:</li>
</ol>
<ul>
<li>Producer Price Index: Carrots, symbol = “WPU01130212”</li>
<li>Producer Price Index: Tomatoes, symbol = “WPU01130217”</li>
<li>Producer Price Index: Corn, symbol = “WPS012202”</li>
</ul>
<ol start="2" type="1">
<li>Rename the symbols to a more descriptive name.</li>
</ol>
<ul>
<li>Carrot Producer Price</li>
<li>Tomato Producer Price</li>
<li>Corn Producer Price</li>
</ul>
<ol start="3" type="1">
<li>Write each data frame as separate csv files:</li>
</ol>
<ul>
<li>carrot_prices.csv</li>
<li>tomato_prices.csv</li>
<li>corn_prices.csv</li>
</ul>
</div>
</div>
</section>
</section>
<section id="video-collecting-data-via-api" class="level3">
<h3 class="anchored" data-anchor-id="video-collecting-data-via-api">Video: Collecting Data via API</h3>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/zuDOOmQtnrM" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<div class="callout callout-style-default callout-tip callout-titled" title="Lab Script for Week 5: Time Series Exploratory Data Analysis (EDA)">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lab Script for Week 5: Time Series Exploratory Data Analysis (EDA)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the script for lab 05.</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Load necessary libraries</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">#epoch</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">as.Date</span>(<span class="st">"1970-01-01"</span>))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">#add one day to see how dates are tracked</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">as.Date</span>(<span class="st">"1970-01-02"</span>))</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Read in the data</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>egg_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://csu-arec-330.github.io/materials/unit_01/inputs/APU0000708111.csv"</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Confirm that R read in the date field as a date</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(egg_raw)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Read in the data</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>egg_raw_c <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://csu-arec-330.github.io/materials/unit_01/inputs/APU0000708111_cdate.csv"</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Confirm that R read in the date field as text and *not* a date</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(egg_raw_c)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co"># The easiest way to get lubridate is to install the whole tidyverse:</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively, install just lubridate:</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"lubridate"</span>)</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the necessary libraries</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the mutate() function along with the mdy() function to convert the text date to a date value</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>egg_raw_c <span class="ot">&lt;-</span> <span class="fu">mutate</span>(egg_raw_c,<span class="at">measure_date=</span><span class="fu">mdy</span>(CHAR_DATE))</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="co">#Confirm that you have successfully converted the variable to a date field</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(egg_raw_c)</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>egg_raw_c <span class="sc">%&gt;%</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">measure_date=</span><span class="fu">mdy</span>(CHAR_DATE)) <span class="sc">%&gt;%</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="co">#Install the package if you have not already done so. Comment this out after you have installed it once on your machine.</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyquant"</span>)</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the library. The library needs to be loaded every time you begin a new instance of R.</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyquant, <span class="at">quietly =</span> <span class="cn">TRUE</span>) <span class="co">#Note: The argument quietly = T in the library() function suppresses messages that would normally be printed when loading a package.</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the tq_get() function to retrieve the time series data</span></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>egg_raw_tq <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="st">"APU0000708111"</span>,</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">get =</span> <span class="st">"economic.data"</span>,</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>                     <span class="at">from=</span><span class="st">"1990-01-01"</span>,</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">to=</span><span class="st">"2024-02-28"</span>)</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(egg_raw_tq)</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the tq_get() function to retrieve two time series datasets</span></span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>egg_raw_tq <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="fu">c</span>(<span class="st">"APU0000708111"</span>,<span class="st">"WPU017107"</span>),</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>                     <span class="at">get =</span> <span class="st">"economic.data"</span>,</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>                     <span class="at">from=</span><span class="st">"1990-01-01"</span>,</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>                     <span class="at">to=</span><span class="st">"2024-02-28"</span>)</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(egg_raw_tq)</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a><span class="co">#Display the unique values of the variable symbol</span></span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(egg_raw_tq<span class="sc">$</span>symbol)</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a><span class="co">#Count the number of observations associated with each value of symbol</span></span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(egg_raw_tq<span class="sc">$</span>symbol)</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the FRED API to retrieve two data series and rename them the series with a more descriptive name</span></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>egg_out <span class="ot">&lt;-</span> egg_raw_tq <span class="sc">%&gt;%</span></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">description=</span><span class="fu">case_when</span>(</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>    symbol <span class="sc">==</span> <span class="st">"APU0000708111"</span> <span class="sc">~</span> <span class="st">"Egg Retail Price"</span>, <span class="co">#if symbol equals APU0000708111, then replace value with Egg Retail Price</span></span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>    symbol <span class="sc">==</span> <span class="st">"WPU017107"</span> <span class="sc">~</span> <span class="st">"Egg Producer Price"</span> <span class="co">#if symbol equals WPU017107, then replace value with Egg Producer Price</span></span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a><span class="co">#Write the dataset to a csv file</span></span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(egg_prices, <span class="st">"egg_prices.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="tableau" class="level1">
<h1>Tableau</h1>
<p>A key attribute of time series data is that we observe values of variables across <strong>time</strong>. Effective analysis of time series data in Tableau thus begins with understanding date variables and functions. Next, we want to understand what visualizations are most appropriate for time series analysis. Finally we want to understand how to make these visualizations as effective as possible.</p>
<section id="before-you-begin-2" class="level3">
<h3 class="anchored" data-anchor-id="before-you-begin-2">Before you begin</h3>
<p>Connect to the folder where you have saved <code>carrot_prices.csv</code>, and the three other commodity price series data.</p>
</section>
<section id="date-functions" class="level3">
<h3 class="anchored" data-anchor-id="date-functions">1. Date functions</h3>
<p>Date functions are Tableau functions that use a date or a date-time field in some way, whether it’s part of the input to perform the calculation or whether the output is a date-time field. Let’s learn about different date functions, their expressions, and their use in Tableau.</p>
<p>You can explore these functions by going to <code>Create calculated field</code> (drop down menu in the data field pane). You can filter on date functions by choosing <code>Date</code> from the library of functions. This will list only the functions that are classified as Date functions.</p>
<p>You can look through these on your own, but I will highlight a few here.</p>
<ul>
<li><p>DATEPART (date_part, date, [start_of_week]) returns part of a given date as a number.</p>
<blockquote class="blockquote">
<p>For example, DATEPART (‘month’, #January 23, 2021#) = 1. Note the hashtags</p>
</blockquote></li>
<li><p>DATENAME (date_part, date, [start_of_week]) is similar to DATEPART, but it returns part of a given date as a string.</p>
<blockquote class="blockquote">
<p>For example, DATENAME (‘month’, #January 23, 2021#) = January</p>
</blockquote></li>
<li><p>DATEADD (date_part, increment, date) returns a date in which the specified increment has been added to the given date.</p>
<blockquote class="blockquote">
<p>For example, DATEADD (‘day’, 7, #January 23, 2021#) = January 30, 2021</p>
</blockquote></li>
<li><p>DATEDIFF (date_part, start_date, end_date, [start_of_week]) returns the difference between the two dates using the specified date part.</p>
<blockquote class="blockquote">
<p>For example, DATEDIFF (‘day’, #January 23, 2021#, #February 24, 2021#) = 32 and DATEDIFF (‘month’, #January 23, 2021#, #February 24, 2021#) = 1</p>
</blockquote></li>
<li><p>DATETRUNC (date_part, date, [start_of_week]) truncates or “rounds down” the given date to the level of the specified date_part. This function returns a new date.</p>
<blockquote class="blockquote">
<p>For example, when you truncate a date that is in the middle of the month at the month level, this function returns the first day of the month. So DATETRUNC (‘month’, #January 23, 2021#) returns January 1, 2021.</p>
</blockquote></li>
<li><p>MIN (expression) returns the earliest date across all records, and MIN (expression 1, expression 2) returns the earlier of the two dates for each record.</p>
<blockquote class="blockquote">
<p>For example, MIN ([Order Date]) returns the earliest date in the Order Date field.</p>
</blockquote></li>
<li><p>MAX (expression) returns the latest date across all records, and MAX (expression 1, expression 2) returns the earlier of the two dates for each record.</p>
<blockquote class="blockquote">
<p>For example, MAX ([Order Date]) returns the latest date in the Order Date field.</p>
</blockquote></li>
</ul>
<p>Here are some handy definitions for date_time arguments:</p>
<p><img src="includes/date_args.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-note callout-titled" title="You do it">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You do it
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Create a calculated field named <code>months_ago</code> that determines the number of months between the commodity price data and today.</p></li>
<li><p>Create a calculated field named <code>first_date</code> that determines the earliest date in the data.</p></li>
<li><p>Create a calculated field named <code>last_date</code> that determines the last date that the carrot price index was less than 135.</p></li>
<li><p>Create a new variable called <code>month</code> that only includes the month.</p></li>
<li><p>Create a new variable called <code>year</code> that only includes the year.</p></li>
<li><p>Create a new date variable called <code>my_date</code> that assigns a new date using your <code>month</code> and <code>year</code> variables and sets the day as 15.</p></li>
</ol>
</div>
</div>
</section>
<section id="visualize-time-series-data" class="level3">
<h3 class="anchored" data-anchor-id="visualize-time-series-data">2. Visualize time series data</h3>
<p>What types of visualizations are most appropriate for time series data?</p>
<ul>
<li><p>Line graphs</p></li>
<li><p>Bar charts</p></li>
<li><p>Dot plots</p></li>
<li><p>Others?</p></li>
</ul>
<p>Let’s experiment with creating these visualizations for time series:</p>
<ol type="1">
<li><p>Create a line graph that shows the value of carrots over time (by month)</p></li>
<li><p>Add markers to your line graph</p></li>
<li><p>Change your line graph to a bar graph dot chart</p></li>
<li><p>Change your bar graph to a dot plot</p></li>
<li><p>Change the size, colors, and opacity of the dots in your dot plot (use the <code>Size</code> and <code>Color</code> icons)</p></li>
<li><p>Change the markers in your chart from dots to a different shape (use the drop down menu on the <code>Marks</code> card, then use the <code>Shape</code> icons)</p></li>
</ol>
<section id="modifying-data-display-in-charts" class="level4">
<h4 class="anchored" data-anchor-id="modifying-data-display-in-charts">Modifying Data Display in Charts</h4>
<p>Now let’s experiment with changing what data is shown in your chart:</p>
<ol type="1">
<li><p>Change your x-axis to annual</p></li>
<li><p>Create one line that shows the average value of the commodity each year, one line that shows the maximum value, and one that shows the minimum value. Can you get all three of these lines in a single pane?</p></li>
<li><p>Restrict your date ranges so that your visualization only shows the last 20 years of data (use the <code>Filters</code> card)</p></li>
</ol>
</section>
</section>
<section id="creating-and-interpreting-trend-lines" class="level3">
<h3 class="anchored" data-anchor-id="creating-and-interpreting-trend-lines">3. Creating and interpreting trend lines</h3>
<p>Now we are going to add a trend line to our visualization. I am sure you are all familiar with trend lines, but do you know <em>how</em> they are created? Let’s start with a linear trend line…</p>
<ul>
<li>What does a linear trend line tell you about your time series data?</li>
<li>How is this trend line estimated? (conceptually… we will go through some equations in lecture)</li>
</ul>
<section id="trend-lines-in-tableau" class="level4">
<h4 class="anchored" data-anchor-id="trend-lines-in-tableau">Trend Lines in Tableau</h4>
<ol type="1">
<li><p>Open a new worksheet and create a line chart showing the monthly values of the commodity from 1990 through 2022.</p></li>
<li><p>Add a trend line to your chart.</p></li>
<li><p>When you click on the trend line, what information does Tableau give you about it? What does this information mean?</p></li>
<li><p>When you click on <code>describe trend model</code> what information does Tableau give you about it?</p></li>
<li><p>Change your x-axis to annual. Did your trend line change? How do you know? Why did or didn’t the trend line change when you changed the date aggregation?</p></li>
</ol>
</section>
</section>
<section id="visualizing-structural-breaks" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-structural-breaks">4. Visualizing structural breaks</h3>
<p>Usually, in long time series data, we can see distinct points where trends change. These are called structural breaks. There are ways to <em>test</em> for structural breaks, but for now, let’s visually inspect them.</p>
<ol type="1">
<li><p>Looking at your visualization of monthly carrot prices and the linear trend line, does your trend line accurately reflect trends in the data for the entire period from 1990 to 2022?</p></li>
<li><p>Identify a month-year where it appears that trends in your data changed.</p></li>
<li><p>Add a <strong>reference line</strong> at this month-year. (Right-click on the x-axis and select <code>Reference Line</code>) Does anything happen to your trend line?</p></li>
</ol>
<section id="methods-for-highlighting-structural-breaks" class="level4">
<h4 class="anchored" data-anchor-id="methods-for-highlighting-structural-breaks">Methods for Highlighting Structural Breaks</h4>
<p><strong>Method 1:</strong> Separate Your Time Series by Adding Color</p>
<ol type="1">
<li><p>Create a new calculated field named <code>before_after_break</code>. Use the <code>IF</code> and <code>THEN</code> functions and an appropriate <code>Date</code> function to populate this variable with “after” if the date is after the break and “before” if the date is before the break.</p></li>
<li><p>Drag this variable to the <code>Color</code> card.</p></li>
<li><p>Add trend lines to your visualization. What happens?</p></li>
</ol>
<p><strong>Method 2:</strong> Separate Your Time Series by Segmenting the X-Axis</p>
<ol type="1">
<li><p>Drag your new variable from the <code>Marks</code> card to the <code>Columns</code> shelf.</p></li>
<li><p>Sort your variable so that the “after” time period is shown following the “before” time period.</p></li>
<li><p>In the x-axis Edit Axis menu, select <code>independent axis ranges for each row or column</code> (right-click on the x-axis to access this menu).</p></li>
<li><p>Note: Typically, Tableau automatically adjusts these panes to be the same size, but you can set them to be different sizes based on the windows you have set by toggling back and forth in your date variable aggregation.</p></li>
</ol>
</section>
</section>
<section id="creating-panes-to-visualize-mutiple-time-series" class="level3">
<h3 class="anchored" data-anchor-id="creating-panes-to-visualize-mutiple-time-series">5. Creating panes to visualize mutiple time series</h3>
<p>Sometimes we might want to view multiple time series in separate figures. We can do this with panes in our visualizations.</p>
<p>Let’s start by bringing in some price data for a few new commodities.</p>
<ol type="1">
<li><p>On the <code>Data Source</code> page, connect to the following data sources: <code>corn_prices.csv</code> and <code>tomatoes_prices.csv</code>.</p></li>
<li><p>We are going to create a <code>relationship</code> between these data sources and our current working file.</p></li>
<li><p>With the carrot data in the <code>canvas</code>, drag one of the other data sources next to it in the canvas. Do the same with the other data source.</p></li>
<li><p>Now go to a new worksheet, what do you see? What did we just accomplish?</p></li>
</ol>
<p>Now that we have all these data sources in a single file and they are structured in a “wide” format, we are going to construct time series plots that let us compare trends in these commodity prices across time.</p>
<section id="comparing-trends-across-commodities" class="level4">
<h4 class="anchored" data-anchor-id="comparing-trends-across-commodities">Comparing Trends Across Commodities</h4>
<ol type="1">
<li><p>Open a new worksheet and create a line plot of the prices over time for each commodity.</p></li>
<li><p>Try formatting your figure: change colors, adjust sizes, etc.</p></li>
<li><p>Use your <code>before_after_break</code> variable to examine whether all the commodities appear to have a structural break at the time you identified for the first commodity.</p></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled" title="You do it">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You do it
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Connect to the egg data that we assembled in R.</p></li>
<li><p>Create a time series of the price. How many lines are there? What is the default calculation doing?</p></li>
<li><p>Differentiate the price series by dragging <code>Description</code> (a dimension) to the color under Marks. You should see two lines but the scales are off. What’s wrong?</p></li>
<li><p>Rescale one of the series to match the other. You can go back to R to do this or do it in Tableau. In either case, you will want to use if/then logic.</p></li>
</ol>
</div>
</div>
</section>
</section>
<section id="video-using-tableau-to-visualize-time-series-data" class="level3">
<h3 class="anchored" data-anchor-id="video-using-tableau-to-visualize-time-series-data">Video: Using Tableau to Visualize Time Series Data</h3>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/6oOu5DqtakY" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://knowledge.broadcom.com/external/article/57052/how-to-convert-unix-epoch-time-values-in.html#:~:text=Epoch%20%2F%20UNIX%20time%20is%20the,on%20the%2070%20years%20difference.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>