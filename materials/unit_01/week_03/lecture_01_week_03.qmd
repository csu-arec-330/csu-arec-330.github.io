---
title: "Week 8: <br>Prediction Intervals and Advanced Forecasting Options<br>"
format: 
  revealjs:
    theme: [night, ../../custom.scss]
    slide-number: c/t
    width: 1400
    # logo: path.png
    # center: TRUE
---

## Agenda 

Forecast prediction intervals

Advanced forecasting I: Exponential models

Advanced forecasting II: Cross-validation

Project 1 reminder and details


<!-- example of big text fit to slide width -->

<!-- ::: {.r-fit-text} -->
<!-- Big Text -->
<!-- ::: -->

<!-- :::: {.columns style="text-align: center"} -->
<!-- ::: {.column width="40%"} -->
<!-- ::: -->
<!-- ::: {.column width="60%"} -->
<!-- ::: -->
<!-- :::: -->


# Intro to Prediction Intervals

## But first... A review question {.scrollable .smaller}

![](includes/tableau_reg.png){width="100%"}


Which value indicates whether the estimated relationship between carrot prices and time is statistically significantly different from zero?

A. 0.0728323  

B. 189.513  

C. 0.0288396  

D. 0.0204868  

# 
::: {.r-fit-text }
**What are *prediction intervals*?** <br> <br>
The interval within which we expect  <br> 
values of our $y$ variable to lie at <br> 
a given point in time
:::

## Prediction intervals: An Example 

- Our forecast from last time predicted that carrot prices will be 275.91 on January 1, 2025.

- We recognize that it is incredibly unlikely for us to perfectly predict carrot prices in two years...

- Instead, what if we construct a *range* of estimates that we are pretty confident encompasses the true value of carrot prices in two years?

- Perhaps we are reasonably sure the true price will be between 200 and 350...

## Prediction intervals: The intuition 

The intuition for prediction intervals begins with understanding *confidence intervals*:

1. What are confidence intervals (CIs)?

    - A range of values that describe the uncertainty of an estimate.

    - Similarly to p-values, CIs give us information on whether estimates are statistically significantly different from zero - does the interval include 0?

    - CIs go beyond p-values and give us the range of possible effects or correlations.

## Prediction intervals: The intuition 

2. How are confidence intervals calculated?

    - Using the estimate, its standard error, the sample size, critical values, and an assumption on the distribution of your data.

![](includes/tableau_describe.png){width="100%"}

<!--
    - The 95% CI for the relationship between our time variable and carrot prices is 
-->

## Prediction intervals: The intuition 

3. How are confidence intervals different from prediction intervals?

    - Prediction intervals are concerned with bounding our *predictions*.

    - Prediction intervals are always wider than CIs becayse of the added uncertainty involved in predicting a single response versus estimating the mean response.

    - Prediction intervals increase as we try to forecast further in the future.


## Prediction intervals: The intuition 

The most frequently used prediction (and confidence) interval is 95%.

**The intuitive interpretation**: we are 95% confident that our prediction interval contains/encompasses the value of our outcome variable that will be realized.

In Tableau (and most other software) prediction intervals are shown with shaded regions around the prediction.

# 
::: {style="text-align: center"}
![](includes/Tableau_forecast.png){width="100%"}
:::

## Prediction intervals: Estimation

Like CIs, prediction intervals require a few inputs and assumptions.

The formula for the standard 95% prediction interval for the $h$-step forecast is:

$$
\widehat{y}_{T+h|T} \pm 1.96 \cdot \widehat{\sigma}_h
$$

where,
$\widehat{y}_{T+h|T}$ is our prediction of $y$ $h$ periods from the end of our data,

1.96 is the multiplier for a 95% prediction interval assuming that our sampling distribution of future observations is normal...,

$\widehat{\sigma}_h$ is an estimate of the standard deviation for the $h$-step forecast

# 
::: {.r-fit-text }
**The objective:** <br>
We want to understand the <br> 
relationship between two variables
:::
#

::: {.r-fit-text }
**The simple solution:** <br> 
Assume the relationship is linear <br> 
and estimate the "average" trend
:::


## Linear regression: The intuition

::: {style="text-align: center"}
![](includes/carrot_scatter.png){width="80%"}

::: 

## Linear regression: The intuition {.scrollable}

How could we use these data to answer:

1.  Are carrot prices, on average, increasing or decreasing?

2.  How much of the observed variation in carrot prices can be explained by a simple trend line?

3.  What is the most reasonable prediction of carrot prices 250 months after the financial crisis?

## Exercise 1: Which trend line is best?
![](includes/carrot_trend2.png){width="45%"}![](includes/carrot_trend3.png){width="45%"}
![](includes/carrot_trend1.png){width="45%"}![](includes/carrot_trend4.png){width="45%"}

#
::: {.r-fit-text }
**Which trend line is best?** <br> 
Why?<br> 
:::

## Linear regression: The intuition {.scrollable}

How could we use these data to answer:

1.  **Are carrot prices, on average, increasing or decreasing?**

    - **Increasing (slightly)**

2.  How much of the observed variation in carrot prices can be explained by a simple trend line?

3.  What is the most reasonable prediction of carrot prices 250 months after the financial crisis?

## Linear regression: The intuition {.scrollable}

![](includes/carrot_ols1.png){width="80%"}

## The Ordinary Least Squares Regression 

Ordinary Least Squares (OLS) is the most common estimation method for linear models.

For a good reason: 

As long as your model satisfies the OLS assumptions you're getting the BEST possible estimates.

BEST = accurate (unbiased) + most precise (best)

Tableau, Excel, and other programs use OLS to estimate trend lines.

## OLS: Unbiased {.scrollable}

What do we mean by "unbiased"?

- predictions are correct on average

- the average value of errors (the distance between observations and predictions) equals zero

# 
![](includes/estimates_bias.png){width="100%"}

::: {style="font-size: 80%;"}
*Source:* [Statistics by Jim](https://statisticsbyjim.com/regression/gauss-markov-theorem-ols-blue/)

:::

## OLS: Best {.scrollable}

What do we mean by "best"?

- predictions have the smallest possible variance

- larger variance = larger probability that our estimates are further away from the correct/true/observed value

# 
![](includes/estimates_precision.png){width="100%"}

::: {style="font-size: 80%;"}
*Source:* [Statistics by Jim](https://statisticsbyjim.com/regression/gauss-markov-theorem-ols-blue/)

:::


## OLS: Equation

![](includes/reg_eq.png){width="100%"}

## OLS: Estimation {.scrollable}

**Problem:** 

We need to estimate $\beta_0$ and $\beta_1$ using observed values of $Y_i$ and $X_i$

**Solution:** 

$$
\widehat{\beta}_0 = \bar{Y} - \frac{\sum_{i=1}^n\left(Y_i-\bar{Y}\right)\left(X_i-\bar{X}\right)}{\sum_{i=1}^n\left( X_i-\bar{X} \right)^2}\cdot \bar{X}
$$

$$
\widehat{\beta}_1 = \frac{\sum_{i=1}^n\left(Y_i-\bar{Y}\right)\left(X_i-\bar{X}\right)}{\sum_{i=1}^n\left( X_i-\bar{X} \right)^2}
$$

## OLS: Interpretting Tableau output

![](includes/carrot_trend_desc.png){width="100%"}

## Q: What is our "Y" variable?

![](includes/tableau_reg.png){width="100%"}


A. `months_since_crisis`

B. `0.0728323`

C. `Avg. Carrot price`

D. `189.513`

## Q: What is our "X" variable?

![](includes/tableau_reg.png){width="100%"}

A. `months_since_crisis`

B. `0.0728323`

C. `Avg. Carrot price`

D. `189.513`


## Q: What is our estimate of $\beta_0$?

![](includes/tableau_reg.png){width="100%"}


A. `months_since_crisis`

B. `0.0728323`

C. `Avg. Carrot price`

D. `189.513`

## Q: What is our estimate of $\beta_1$?

![](includes/tableau_reg.png){width="100%"}

A. `months_since_crisis`

B. `0.0728323`

C. `Avg. Carrot price`

D. `189.513`

## Discussion: Interpretting Tableau output

![](includes/tableau_reg.png){width="100%"}

$$
Y_i = \beta_0 + \beta_1 X_i + \varepsilon_i
$$

What is does $\beta_0$ represent? How can we interpret it? What does it mean for how the trend line will appear in our visualization?

## Discussion: Interpretting Tableau output

![](includes/tableau_reg.png){width="100%"}

$$
Y_i = \beta_0 + \beta_1 X_i + \varepsilon_i
$$

What is does $\beta_1$ represent? How can we interpret it? What does it mean for how the trend line will appear in our visualization?


## Interpretting Tableau output: What is $R^2$?

![](includes/tableau_reg.png){width="100%"}

- A statistical measure of "fit"

- It tells us how much variation of the $Y$ variable is explained by the $X$ variable(s)

- Higher $R^2$ =  better fit; $R^2$ = 1 $\Rightarrow$ all variation is explained; [More info](https://www.ncl.ac.uk/webtemplate/ask-assets/external/maths-resources/statistics/regression-and-correlation/coefficient-of-determination-r-squared.html)

## 

![](includes/r_sq.png){width="100%"}

## Linear regression: The intuition {.scrollable}

How could we use these data to answer:

1.  Are carrot prices, on average, increasing or decreasing?

    - Increasing (slightly)

2.  **How much of the observed variation in carrot prices can be explained by a simple trend line?**

    - **Not much!**

3.  What is the most reasonable prediction of carrot prices 250 months after the financial crisis?


## Interpretting output: What is P-value?

![](includes/tableau_reg.png){width="100%"}

- Tableau's default P-value is a measure of the significance for slope parameter $\beta_1$

- smaller p-value = better 

- A p-value of 0.05 or less is often considered statistically significant $\Rightarrow$ statistically significantly different from 0; [More info](https://www.w3schools.com/datascience/ds_linear_regression_pvalue.asp)

## Interpretting: What is P-value?

Note that clicking "describe trend line" will also give you a p-value for the intercept parameter.

![](includes/tableau_describe.png){width="100%"}


## Q: How well does the model fit the data?

![](includes/exercise.png){width="100%"}


A. Extremely well

B. Decent

C. Not well

## Q: How confident are you that the estimated slope is different from zero?

![](includes/exercise.png){width="100%"}


A. Very

B. Somewhat

C. Not at all

## Using OLS regressions to forecast

::: {style="text-align: center"}
![](includes/forecast.jpeg){width="75%"}

::: 

## Using OLS regressions to forecast

**How?**

- Continue/extend your trend beyond your time series

- Tableau and other programs can do this for you automatically

- You can also do this manually by plugging in values of your $X$ variable(s)...

## Using OLS regressions to forecast

**What is the most reasonable prediction of carrot prices 250 months after the financial crisis?**

![](includes/tableau_reg.png){width="100%"}

$$
\hat{Y} = 189.513 + 0.0728323*(250) = 207.721
$$


## 
::: {style="text-align: center"}
![](includes/linear_forecast.png){width="80%"}

::: 

## Linear regression: The intuition {.scrollable}

How could we use these data to answer:

1.  Are carrot prices, on average, increasing or decreasing?

    - Increasing (slightly)

2.  How much of the observed variation in carrot prices can be explained by a simple trend line?

    - Not much!

3.  **What is the most reasonable prediction of carrot prices 250 months after the financial crisis?**

    - **BEST estimate: 207**


## Considerations when using OLS to forecast

1. Is your relationship linear?

## 
::: {style="text-align: center"}
![](includes/nonlinear_trend.webp){width="80%"}

::: 

## Considerations when using OLS to forecast

1. Is your relationship linear?

    - Consider including a non-linear transformation of your X variable, e.g., $Y_i = \beta_0 +\beta_1 X_i +\beta_2 X_i^2 +\varepsilon_i$

2. What time period should you use to estimate the trend?

## 
::: {style="text-align: center"}
![](includes/carrot_longtrend.png){width="80%"}

::: 

## Considerations when using OLS to forecast

1. Is your relationship linear?

    - Consider including a non-linear transformation of your X variable, e.g., $Y_i = \beta_0 +\beta_1 X_i +\beta_2 X_i^2 +\varepsilon_i$

2. What time period should you use to estimate the trend?

    - Test for structural breaks

    - Decide how to account for structural breaks

    - E.G., are structural breaks regularly occuring? (perhaps prices jump every 20 years)

## Cautionary note 

- We will teach you enough to be dangerous

- We are introducing you to the tip of the analytical iceberg.  Learn more before you put this into practice.

- Incorrect analysis can lead to worse conclusions than no analysis

::: {.incremental}

- Be wary of causal conclusions!

:::

## The "effect" of education on income?

::: {style="text-align: center"}
![](includes/income_educ.png){width="70%"}

:::


# 
::: {.r-fit-text }
CORRELATION $\neq$ CAUSATION

:::



## REMINDER: Project 1

Groups of 2

Choose an ag biz or enre management question to answer with time series data

Collect time series data

Analyze trends 

Generate a forecast 

Present results in class Fri March 10