<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 7 Lab: Forecasting and Prediction Intervals</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="lab_01_week_03_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab_01_week_03_files/libs/quarto-html/quarto.js"></script>
<script src="lab_01_week_03_files/libs/quarto-html/popper.min.js"></script>
<script src="lab_01_week_03_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab_01_week_03_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab_01_week_03_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab_01_week_03_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab_01_week_03_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab_01_week_03_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab_01_week_03_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-objectives-r" id="toc-learning-objectives-r" class="nav-link active" data-scroll-target="#learning-objectives-r">Learning Objectives R</a></li>
  <li><a href="#learning-objectives-tableau" id="toc-learning-objectives-tableau" class="nav-link" data-scroll-target="#learning-objectives-tableau">Learning Objectives Tableau</a></li>
  <li><a href="#r-time-series-forecast-and-prediction-interval" id="toc-r-time-series-forecast-and-prediction-interval" class="nav-link" data-scroll-target="#r-time-series-forecast-and-prediction-interval">R: Time Series Forecast and Prediction Interval</a>
  <ul class="collapse">
  <li><a href="#step-1-load-your-data" id="toc-step-1-load-your-data" class="nav-link" data-scroll-target="#step-1-load-your-data">Step 1: Load your data</a></li>
  <li><a href="#step-2-convert-your-data-into-a-time-series-object" id="toc-step-2-convert-your-data-into-a-time-series-object" class="nav-link" data-scroll-target="#step-2-convert-your-data-into-a-time-series-object">Step 2: Convert your data into a time series object</a></li>
  <li><a href="#step-3-tidy-forecast-workflow" id="toc-step-3-tidy-forecast-workflow" class="nav-link" data-scroll-target="#step-3-tidy-forecast-workflow">Step 3: Tidy forecast workflow</a></li>
  <li><a href="#prediction-intervals" id="toc-prediction-intervals" class="nav-link" data-scroll-target="#prediction-intervals">Prediction intervals</a></li>
  <li><a href="#preparing-to-export" id="toc-preparing-to-export" class="nav-link" data-scroll-target="#preparing-to-export">Preparing to export</a></li>
  </ul></li>
  <li><a href="#tableau" id="toc-tableau" class="nav-link" data-scroll-target="#tableau">Tableau</a>
  <ul class="collapse">
  <li><a href="#plotting-prediction-intervals-in-tableau" id="toc-plotting-prediction-intervals-in-tableau" class="nav-link" data-scroll-target="#plotting-prediction-intervals-in-tableau">Plotting prediction intervals in Tableau</a>
  <ul class="collapse">
  <li><a href="#option-1-dont-worry-about-shading" id="toc-option-1-dont-worry-about-shading" class="nav-link" data-scroll-target="#option-1-dont-worry-about-shading">Option 1: Don’t worry about shading</a></li>
  <li><a href="#option-2-lets-jump-through-some-hoops-to-add-shading" id="toc-option-2-lets-jump-through-some-hoops-to-add-shading" class="nav-link" data-scroll-target="#option-2-lets-jump-through-some-hoops-to-add-shading">Option 2: Let’s jump through some hoops to add shading</a></li>
  </ul></li>
  <li><a href="#presenting-tableau-option-1-stories" id="toc-presenting-tableau-option-1-stories" class="nav-link" data-scroll-target="#presenting-tableau-option-1-stories">Presenting Tableau Option 1: Stories</a></li>
  <li><a href="#presenting-tableau-option-2-embed-in-powerpoint" id="toc-presenting-tableau-option-2-embed-in-powerpoint" class="nav-link" data-scroll-target="#presenting-tableau-option-2-embed-in-powerpoint">Presenting Tableau Option 2: Embed in Powerpoint</a></li>
  <li><a href="#now-get-together-with-your-teammate-and-spend-some-time-on-your-project" id="toc-now-get-together-with-your-teammate-and-spend-some-time-on-your-project" class="nav-link" data-scroll-target="#now-get-together-with-your-teammate-and-spend-some-time-on-your-project">Now get together with your teammate and spend some time on your project!</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 7 Lab: Forecasting and Prediction Intervals</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><img src="includes/generic_forecasting.webp" class="img-fluid"></p>
<div style="font-size: 1.5em">
<p>This Lab Contributes to Course Objectives: 1, 2, 3, 4, 7, 8</p>
</div>
<section id="learning-objectives-r" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives-r">Learning Objectives R</h2>
<ul>
<li><p>Understand the statistics of prediction intervals</p></li>
<li><p>Understand how to conduct a forecast with prediction intervals in R</p></li>
</ul>
</section>
<section id="learning-objectives-tableau" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives-tableau">Learning Objectives Tableau</h2>
<ul>
<li><p>Plot your prediction intervals</p></li>
<li><p>Using Tableau stories to present</p></li>
<li><p>Embedding Tableau in Powerpoint to present</p></li>
</ul>
</section>
<section id="r-time-series-forecast-and-prediction-interval" class="level1">
<h1>R: Time Series Forecast and Prediction Interval</h1>
<p>Last week we learned how to build a forecast from the components of the time series decomposition (Trend, Seasonality, and Residual). We made some relatively simple assumptions about how these components would behave in the future. R has many time series analysis and forecasting tools. Because the libraries containing the tools are open source and written by R users, the structure of the functions and object created by them may vary. We are going to start using a new library called <code>fpp3</code> that you will need to install if it isn’t already installed. <code>fpp3</code> is a meta-library that loads a series of time series forecasting libraries that make time series analysis and forecasting much easier. The library <code>fpp3</code> was created as the companion to the textbook <a href="https://otexts.com/fpp3/">Forecasting: Principles and Practice (3rd ed)</a>]. The main libraries we will be using are <code>fable</code> and <code>feasts</code>. <code>fable</code> contains many time series models that you might want to use to understand and forecast data. <code>feasts</code> contains a set of <code>dplyr</code>-like tools to work with time series data. This set of packages makes it <em>very easy</em> to run models and extract the information you want.</p>
<p>The goal today is to look at prediction intervals, which are related to confidence intervals but pertain to your forecast.</p>
<section id="step-1-load-your-data" class="level3">
<h3 class="anchored" data-anchor-id="step-1-load-your-data">Step 1: Load your data</h3>
<p>First, let’s load the time series data into R and set up your script (description, working directory, load packages). We will continue using the carrot price data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This lab...</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyquant)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>carrot <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="fu">c</span>(<span class="st">"WPU01130212"</span>),<span class="at">get =</span> <span class="st">"economic.data"</span>,<span class="at">from=</span><span class="st">"2007-08-01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-convert-your-data-into-a-time-series-object" class="level3">
<h3 class="anchored" data-anchor-id="step-2-convert-your-data-into-a-time-series-object">Step 2: Convert your data into a time series object</h3>
<p>Like last week, we need to convert our data into a time series dataframe called a <code>tsibble</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Prep data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>carrot_ts <span class="ot">&lt;-</span> carrot <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date,price) <span class="sc">%&gt;%</span> <span class="co">#select only the date and price variables</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date=</span><span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span> <span class="co">#convert the date into yearmonth format so the models understand the unit of observation</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="co">#convert the data to a tsibble object - similar to a tibble or data.frame but for time series data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will create a new time series <code>tibble</code> object called <code>carrot_ts.</code></p>
</section>
<section id="step-3-tidy-forecast-workflow" class="level3">
<h3 class="anchored" data-anchor-id="step-3-tidy-forecast-workflow">Step 3: Tidy forecast workflow</h3>
<p>Again, our objective is to build a forecast model and extract the key pieces of information, so that we can send them to Tableau. One of the benefits of the <code>fpp3</code> package is that it simplifies model building process in a structure that is compatible with the pipe, <code>%&gt;%</code>. We will recreate the forecasting model that we built in parts last week. Recall that we first decomposed the carrot price time series into <code>trend</code>, <code>seasonal</code>, and <code>random</code> components, and built a forecasting model based on each component, then put it all back together.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> That process can be called a workflow - a set of steps for completing a task. We will translate the workflow we built into the structure of the new package.</p>
<section id="a-define-the-model" class="level4">
<h4 class="anchored" data-anchor-id="a-define-the-model">3a: Define the model</h4>
<p>We have the time series data prepared for modeling. Now, we need to define the model. We defined individual forecasts for each of the three components in week 2. We used the function, <code>forecast</code>, which uses an <code>exponential smoothing</code> method by default. We can be more explicit in defining an exponential smoothing model of each component.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit the model</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> carrot_ts <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">my_ets=</span><span class="fu">ETS</span>(price <span class="sc">~</span> <span class="fu">trend</span>(<span class="at">method=</span><span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="at">method=</span><span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">error</span>(<span class="at">method=</span><span class="st">"A"</span>))) <span class="co">#fit model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function model is used to define the forecasting model. In this case, we define an exponential smoothing model, <code>ETS()</code>, based on three components: <code>trend</code>, <code>season</code>, and <code>error</code>. The argument <code>method="A"</code> in each component tells the model that we want those components to be <em>additive</em> rather than multiplicative. Finally, we define the model as <code>my_ets</code>. In short, this defines the model that we built in parts in week 2. Inspecting <code>fit</code> shows that this just defines the model but doesn’t do anything with it.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>Note that <code>model</code> is a powerful function capable of specifying many models at once. You may want to compare model fits or estimate models on several price series simultaneously. See more information <a href="https://fable.tidyverts.org/articles/fable.html">here</a>.</p>
</section>
<section id="b-forecast-the-model" class="level4">
<h4 class="anchored" data-anchor-id="b-forecast-the-model">3b: Forecast the model</h4>
<p>Now that we have specified the model, we need to actually run the forecast. We will use a function called <code>forecast()</code> from the <code>fabletools</code> library (related to <code>fable</code>). However, this function is different from the previously used forecast function. When there are potential conflicts between functions with the same name from different libraries, you can specify the library, so R does not try to use the wrong one. We specify that we want to forecast our <code>ETS</code> model for 5 years. The function understands that you want 5 years worth of monthly forecasts (remember the data is stored as monthly data); this is equivalent to <code>h=60</code> because 60 months is 5 years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Forecast the model</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>carrot_forecast <span class="ot">&lt;-</span> fit <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="st">"5 years"</span>) <span class="co">#forecast model for 5 years</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Inspect <code>carrot_forecast</code> and you will see that it contains mean and variance information for each month of the 5 year forecast.</p>
</section>
<section id="c-plot-the-forecast" class="level4">
<h4 class="anchored" data-anchor-id="c-plot-the-forecast">3c: Plot the forecast</h4>
<p>Finally, you want to visualize your forecast. You can pass <code>carrot_forecast</code> into the function <code>autoplot()</code> that understands how to read forecast output. Note that <code>autoplot()</code> plots only the forecast by default. Adding the observed data <code>carrot_ts</code> tells the function to include the observed data in the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the forecast</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(carrot_forecast,carrot_ts) <span class="co">#forecast model for 5 years</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can see that the mean, the 80%, and the 90% prediction intervals are included.</p>
<p>See <a href="https://otexts.com/fpp3/a-tidy-forecasting-workflow.html">Hyndman and Athanasopoulos</a> for more information on developing a workflow with these time series tools.</p>
</section>
</section>
<section id="prediction-intervals" class="level3">
<h3 class="anchored" data-anchor-id="prediction-intervals">Prediction intervals</h3>
<p>The plot generated by <code>autoplot()</code> indicates that the model is estimating prediction intervals. There is a function <code>hilo()</code> from the <code>fable</code> library to extract them. However, this function creates a column with both upper and lower prediction intervals packed into a single variable. Fortunately, there is a function for separating the values into their own variables called <code>unpack_hilo()</code>. You need to specify the name of the variable; in this case <code>95%</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extract prediction interval</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>carrot_forecast_out <span class="ot">&lt;-</span> carrot_forecast <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hilo</span>(<span class="at">level =</span> <span class="dv">95</span>) <span class="sc">%&gt;%</span> <span class="co">#extract 95% prediction interval</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="st">`</span><span class="at">95%</span><span class="st">`</span><span class="sc">$</span>lower,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="st">`</span><span class="at">95%</span><span class="st">`</span><span class="sc">$</span>upper</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="co">#unpack into own columns named lower and upper</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preparing-to-export" class="level3">
<h3 class="anchored" data-anchor-id="preparing-to-export">Preparing to export</h3>
<p>Finally, we want to prepare the data for export to Tableau. Recall that our original data had two variables: <code>date</code> and <code>price</code>. Our tsibble <code>carrot_forecast_out</code> has <code>date</code> and <code>price</code>, but the <code>price</code> variable is a distribution rather than a value. However, the variable <code>.mean</code> contains the forecast mean, so we can remove <code>price</code> and rename <code>.mean</code>. Remember that you can rename and select variables in the same command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Prepare data for export</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>part2 <span class="ot">&lt;-</span> carrot_forecast_out <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date,<span class="at">price=</span>.mean,<span class="st">`</span><span class="at">lower</span><span class="st">`</span>,<span class="st">`</span><span class="at">upper</span><span class="st">`</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>to_export <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(carrot_ts,part2)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(to_export,<span class="st">"carrot_forecast.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-video ratio ratio-16x9"><iframe src="https://www.youtube.com/embed/KMrGAUcnM00" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
</section>
<section id="tableau" class="level1">
<h1>Tableau</h1>
<section id="plotting-prediction-intervals-in-tableau" class="level2">
<h2 class="anchored" data-anchor-id="plotting-prediction-intervals-in-tableau">Plotting prediction intervals in Tableau</h2>
<p>Last time we showed that if you apply Tableau’s forecasting features, Tableau will automatically plot prediction intervals for you. But what if you want to plot the prediction intervals you created in R instead?</p>
<section id="option-1-dont-worry-about-shading" class="level3">
<h3 class="anchored" data-anchor-id="option-1-dont-worry-about-shading">Option 1: Don’t worry about shading</h3>
<ol type="1">
<li><p>Connect to the <code>carrot_forecast</code> dataset you just exported from R.</p></li>
<li><p>Create two new calculated fields. One called <code>Observed Price</code> and one called <code>Forecasted Price</code>. You can create both of these using an IF THEN statement, for <code>Observed Price</code> we want all prices through the end of our data (January 1, 2023): <code>IF [Date] &lt;= #January 1, 2023# THEN [Price] ELSE NULL END</code>. You should write a similar statement to get <code>Forecasted Price</code> after this date…</p></li>
<li><p>Create a line chart that includes <code>Observed Price</code>, <code>Forecasted Price</code>, <code>Upper</code>, and <code>Lower</code>.</p></li>
<li><p>Change the colors to something useful. Let’s do the same gray shade for both upper and lower.</p></li>
</ol>
</section>
<section id="option-2-lets-jump-through-some-hoops-to-add-shading" class="level3">
<h3 class="anchored" data-anchor-id="option-2-lets-jump-through-some-hoops-to-add-shading">Option 2: Let’s jump through some hoops to add shading</h3>
<ol type="1">
<li><p>Duplicate your previous worksheet.</p></li>
<li><p>Change your chart to an Area Chart.</p></li>
<li><p>“unstack” your lines by going to <code>Analysis</code> -&gt; <code>Stack Marks</code> -&gt; <code>Off</code></p></li>
<li><p>Rearrange the order of your forecast and prediction intervals: Lower, Forecast, Upper.</p></li>
<li><p>Change your colors - white for <code>Observed Price</code> and <code>Lower</code>, gray for <code>Upper</code> and <code>Forecasted Price</code>.</p></li>
<li><p>Create a new line graph by dragging the original <code>Price</code> field to the Rows Shelf.</p></li>
<li><p>Change this new pane to a line chart.</p></li>
<li><p>Change the colors to reflect forecasted and original prices by creating a new calculated field that equals “Forecasted Price” after January 1, 2023, and that equals “Observed Price” before then. Drag this calculated field to the Colors Card.</p></li>
<li><p>Combine your charts by creating a dual axis. Right click the Y-axis -&gt; Select <code>Dual Axis</code></p></li>
<li><p>Sychronize your axes. Right click the second Y-axis -&gt; Select <code>Synchronize Axis</code>. You can then hide this axis. Right click -&gt; Click <code>Show Header</code> to de-select it.</p></li>
<li><p>Notice that the area under the lines no longer has your y-axis gridlines. Let’s just get rid of all the gridlines to make this look a bit nicer. Right click on your chart -&gt; select <code>Format</code>. In the format pane, naviage to the lines icon, change Grid Lines to <code>None</code>.</p></li>
<li><p>Finally, go back to your last sheet. Notice that the colors between your sheets are linked. Tableau does this to ensure your sheets are cohesive, but sometimes we want different colors for the same variable. The workaround for this is to duplicate each of the variables you want to assign a different color and use those in this sheet instead of the original variables.</p></li>
</ol>
</section>
</section>
<section id="presenting-tableau-option-1-stories" class="level2">
<h2 class="anchored" data-anchor-id="presenting-tableau-option-1-stories">Presenting Tableau Option 1: Stories</h2>
<p>Tableau Desktop includes its own method for presenting your analyses. These are called stories. This tutorial will show you how to put together a simple story.</p>
<ol type="1">
<li><p>Create a new story by clicking the <code>New Story</code> tab at the bottom of the window. Change the size to Powerpoint.</p></li>
<li><p>Let’s create an intro slide by creating a new Dashboard. Add a background image and a text box.</p></li>
<li><p>Add your intro slide to your story.</p></li>
<li><p>Add a new (blank) story point and bring in one of your worksheets. Give this story point a useful title.</p></li>
<li><p>See what your story looks like in presentation mode. Note that you can hide the story title to make this look a bit nicer.</p></li>
<li><p>Note that if you like the formatting features of Powerpoint for text slides, you can also create these slides in powerpoint, export them as images and then add those images to Dashboards.</p></li>
</ol>
</section>
<section id="presenting-tableau-option-2-embed-in-powerpoint" class="level2">
<h2 class="anchored" data-anchor-id="presenting-tableau-option-2-embed-in-powerpoint">Presenting Tableau Option 2: Embed in Powerpoint</h2>
<p>You can also embed interactive Tableau dashboards from your Tableau Public account directly into powerpoint. This will require you to install the Web Viewer Add-in. I won’t walk you through how to do this right now, but you can follow these instructions to set this up: <a href="https://vizartpandey.com/how-to-embed-tableau-dashboard-in-a-powerpoint-presentation/?amp" class="uri">https://vizartpandey.com/how-to-embed-tableau-dashboard-in-a-powerpoint-presentation/?amp</a></p>
<div class="quarto-video ratio ratio-16x9"><iframe src="https://www.youtube.com/embed/U2oDUOeDHI8" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
<section id="now-get-together-with-your-teammate-and-spend-some-time-on-your-project" class="level2">
<h2 class="anchored" data-anchor-id="now-get-together-with-your-teammate-and-spend-some-time-on-your-project">Now get together with your teammate and spend some time on your project!</h2>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>I’ve included more information about the model in <a href="../week_02/lab_01_week_02.html">week 2</a> of this unit lab notes.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>You can extract model coefficient estimates using the command <code>tidy(fit)</code> if you need to extract them.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>