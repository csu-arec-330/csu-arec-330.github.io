---
title: "Week 11 Lab: Spatial data in R"
format: 
  html:
    theme: zephyr
    toc: true
---


![](includes/cross-sectional.png)

::: {style="font-size: 1.5em"}
This Lab Contributes to Course Objectives: 1, 3, 4, 5, 7, 8
:::


## Learning Objectives R

- Read and process spatial data

- Prepare data for mapping in Tableau


## Learning Objectives Tableau

- 

# R

Spatial data is a form of cross-sectional data that contains geographic information. Examples include the location of a store or park or the boundary of a parcel of land.

## Orientation and terms

Two forms: vector and raster data


Pop data from
https://sedac.ciesin.columbia.edu/data/set/popdynamics-us-county-level-pop-projections-sex-race-age-ssp-2020-2100/data-download



# Tableau


### 1. Plotting Results from a Cluster Analysis

If you want to show results from your cluster analysis in Tableau, a simple way is to associate each cluster with a specific color. Let's do this now.

1. Connect to your dataset with the results from your cluster analysis. I called this `analyzed_data.csv`.

2. Select `Latitude`, `Longitude`, and `Cluster` and select the Symbol Map from `Show Me`.

3. Recall you will need to change the `Latitude` and `Longitude` fields to Dimensions for this to display correctly.

4. Let's also change `Cluster` to be associated with a color (rather than size) by dragging it to the `Color` card. 

5. Finally, let's change `Cluster` to a Dimension and tell Tableau that it is Discrete.

6. Let's add some more detail to the tooltip. I would like to know the location name, top category, and cluster when I hover over each point on the map.

{{< video https://youtu.be/lXloWsi7hZQ aspect-ratio="16x9" >}}


### 2. Plotting Results from a Regression Analysis

We have already discussed how to use Tableau's integrated regression analysis, but a major limitation to this is that Tableau can only perform single variable regressions. Let's look at the difference between the single and multivariate regression results by creating a scatterplot in Tableau:

1. To compare the single and multivariate regression results we will need to join our `analyzed_data` and `fitted_reg` data sources. Join these two datasets on the `Raw Visitor Counts` field.

2. Open a new sheet and create a scatterplot of `Raw Visitor Counts` and `Distance from Home` (note that we want our Y variable -- `Raw Visitor Counts` -- on the Y-axis).

3. Add a fitted line to your scatterplot.

4. To plot our multivariate regression results on this 2D plot, we will need to select a fixed value of the second variable (`Median Dwell Time`). To demonstrate that we need to do this - try plotting the fitted values of `Raw Visitor Counts` and `Distance from Home`. What do you see?

5. Create a new calculated field, named `Fitted Distance From Home` with the following formula: `IF [Median Dwell (Fitted Reg.Csv)]==3 THEN [Distance From Home (Fitted Reg.Csv)] ELSE NULL END` 
   
**What is this formula doing?**

6. Drag `Fitted Distance From Home` to the columns shelf, and `Raw Visitor Counts (Fitted Reg.Csv)` to the rows shelf. Change both fields to Dimensions.

7. Change this new plot to a line (instead of scatter).

8. Create X and Y dual axes (by right clicking each axis), then synchronize the axes so that they have the same values. Finally you can hide the seconary axes to reduce the clutter.

5. How do the multivariate regression fitted values compare with the single variate ones?

9. Now, what happens if we look at the fitted values assuming `Median Dwell Time` is equal to 4? Edit the calculated field to make this change.

Note that another option for accomplishing this is to simply use the fitted regression equation (from R) to create a new calculated field. To see this, create a new calculated field called `Fitted Visits 2` with the following formula: `8.14165 -0.27568*[Distance From Home] -0.36894*4`.

**Where did these numbers come from?**

{{< video https://youtu.be/nRJaoNmhCzk aspect-ratio="16x9" >}}

### 3. Adding Vizzes to Map Tooltips

The last thing I want to cover today is how to add other visualizations to your map tooltip. To do this, let's create a simple scatterplot of `Raw Visitor Counts` and `Distance from Home` and add a fitted line.

1. Go back to your sheet with your map, color coded by cluster.

2. Open the Tooltip card and go to `Insert` -> `Sheets` and select the sheet with your new scatterplot.

3. When you hover over a point on the map, what is this visualization showing?

4. What if we instead want to show a scatterplot of these two variables only for grocery stores within that cluster? Go back to the Tooltip card and edit the Sheet info from `<Sheet name="Sheet 2" maxwidth="300" maxheight="300" filter="<All Fields>">` to read `<Sheet name="Sheet 2" maxwidth="300" maxheight="300" filter="<Cluster>">`

5. Now what happens when you hover over a point on the map? How did we accomplish this?

6. Let's add a useful title to our scatterplot by typing `Relationship between Visitors and Distance from home for stores in cluster <Cluster>` in the Tooltip above the scatterplot. Then let's adjust the width of the scatterplot to `500`.

{{< video https://youtu.be/y08HjpcHF_4 aspect-ratio="16x9" >}}