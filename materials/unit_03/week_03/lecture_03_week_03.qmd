---
title: "Week 15: <br>Regression Analysis Example and Course Summary <br>"
format: 
  revealjs:
    theme: [night, ../../custom.scss]
    slide-number: c/t
    width: 1400
    # logo: path.png
    # center: TRUE
execute:
  echo: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Agenda 

Project overview emphasizing connection between questions and analysis

Economics research example

Course recap 



<!-- example of big text fit to slide width -->

<!-- ::: {.r-fit-text} -->
<!-- Big Text -->
<!-- ::: -->

<!-- :::: {.columns style="text-align: center"} -->
<!-- ::: {.column width="40%"} -->
<!-- ::: -->
<!-- ::: {.column width="60%"} -->
<!-- ::: -->
<!-- :::: -->

## [Project Overview](project_3.html) {.scrollable}


**The Question:** Your question for Project 3 should be formulated as: What is the association between $x$ (an explanatory variable) and $y$ (some outcome)?

**The Data:** You will use the convenience store data (shopper_info, store_info, gtin) to select your $y$, and choose **one** of the two additional datasets (census data or weather data) to choose your $x$.
 
- **Option 1:** Convenience store data combined with Demographic data from the US Census

- **Option 2:** Convenience store data combined with Weather data from NOAA

# Understanding Gas Prices in Our Community: <br>A Town Hall Discussion

## Introduction {.smaller}

Good evening. I'm Lauren, a local economic analyst.

We're here today because the community needs to consider adding a new access road to Highway 101.

There is room in the town's budget for infrastructure improvements, but there concern that developing new roads might lead to higher fuel costs.

Tonight, I'll present to you analysis my team and I conducted on how gas prices vary with distance to the highway. 

**Goal:** To better understand the trade-offs involved with improving highway access so that you, the town planning committee, can decide to add a new access road.


## The Question

**How does the distance from the nearest highway relate with the price of gas?**

Understanding this can help us predict and manage our travel and budgeting more effectively.


## Data Collection

We gathered data from all convenience stores with gas stations. 

We calculated their distance to the nearest highway and removed stores located further than 40 kilometers away. 

Below is a summary table of average prices per gallon and distances from the nearest highway for our sample of gas stations.

<h2 style="text-align: center; font-weight: bold; font-size:40px">Table: Summary Statistics for Unit Price and Distance</h2>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Mean </th>
   <th style="text-align:right;"> SD </th>
   <th style="text-align:right;"> Min </th>
   <th style="text-align:right;"> Max </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Price Per Gallon </td>
   <td style="text-align:right;"> 3.49 </td>
   <td style="text-align:right;"> 0.36 </td>
   <td style="text-align:right;"> 2.50 </td>
   <td style="text-align:right;"> 5.00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Distance </td>
   <td style="text-align:right;"> 14.75 </td>
   <td style="text-align:right;"> 68.72 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 2,346.76 </td>
  </tr>
</tbody>
</table>

## Distribution of Unit Price and Distance

Figure 1: Matrix of density plots for unit price and distance
```{r}
#| echo: false

# Load necessary libraries
library(pacman)
p_load(tidyverse, modelsummary, sf, progress, GGally, knitr)

# Read in the transaction level data
shopper_info <- read_csv("https://csu-arec-330.github.io/materials/unit_03/inputs/shopper_info.csv.gz")

# Read in store distance data
store_dist <- read_csv("https://csu-arec-330.github.io/materials/unit_03/inputs/store_dist.csv")

# Filter dataset to keep only stores within 40 km of a major road
store_dist_40 <- store_dist %>%
  filter(dist < 40)

# Generate a pair plot using GGally to visualize relationships
ggpairs(store_dist_40, columns = 2:3)
```

## Unit prices appear to decrease as distance to highway increases

Figure 2: Scatter plot of unit price and distance
```{r}
#| echo: false

# Load necessary libraries
library(pacman)
p_load(tidyverse, modelsummary, sf, progress, GGally, knitr)

# Read in the transaction level data
shopper_info <- read_csv("https://csu-arec-330.github.io/materials/unit_03/inputs/shopper_info.csv.gz")

# Read in store distance data
store_dist <- read_csv("https://csu-arec-330.github.io/materials/unit_03/inputs/store_dist.csv")

# Filter dataset to keep only stores within 40 km of a major road
store_dist_40 <- store_dist %>%
  filter(dist < 40)

# Scatter plot of unit prices and distance
ggplot(store_dist_40, aes(x = dist, y = unit_price)) +
  geom_point(alpha = 0.5, color = "blue") +
  theme_minimal()
```

## Analysis

Although we can draw some insights from the scatter plot, we use regression analysis to determine the relationship between distance and price. 

$$ pr_{i} = \beta \cdot Dist_{i} + \alpha_i + \varepsilon_{i} $$

- Outcome: price per gallon

- Explanatory variable: distance to the highway (in kilometers)

- Unit of observation: convenience stores with gas pumps


## Multivariate Regression

After adding additional control variables, we want to test if our results still hold.

$$ pr_{i} = \beta_1 \cdot Dist_{i} + \beta_2 \cdot X_{i} + \alpha_i + \varepsilon_{i} $$

- Outcome: price per gallon

- Explanatory variable: distance to the highway (in kilometers)

- Controls: number of gas stations within 10 kilometers

- Unit of observation: convenience stores with gas pumps


## Interpretation

Our analysis shows a clear trendâ€”each mile away from the highway leads to an increase in gas prices.


Specifically, for every mile a gas station is located away from the highway, the price per gallon increases by 0.005 cents.

## Assumptions and Limitations


## Discussion

This pattern suggests that stations closer to the highway can offer lower prices due to higher traffic and potentially lower transportation costs.

For those living or working far from the highway, this might mean higher daily expenses.

## Conclusion

Our analysis confirms that distance from the highway is a key factor affecting gas prices in our community.

However, the considering the current travel cost to the highway without the access road, offsets the modest expected increase in gas prices.

Possible solutions: 

- Organize carpooling options 

- Support local gas stations with loyalty programs


<!--
## Bats and Ag Land Prices ([Manning & Ando](https://www.journals.uchicago.edu/doi/full/10.1086/720303))

![](includes/09-bats-1024x659.jpeg)

## Research Question

:::{.incremental}
- What effect do bats have on crop production (e.g., corn and soy beans)?

  - No good measure of bats, but we know white nose syndrome (WNS) kills bats
  
  - WNS is monitored by county over time

- What effect does white nose syndrome have on production, and land values?
:::

## What data would you collect?

iclicker short answer

:::{.incremental}
- Outcomes: cash rents, cropland acres

- Treatment: presence of white nose syndrome

- Controls: population, land quality, weather

- Unit of observation: county-year
:::

## How would you specify the regression model?

Think about it.  I'll pick someone to write it on the board.

:::{.incremental}

- $$ y_{it} = \beta \cdot WNS_{it} + \gamma X_{it} + \delta_t + \alpha_i + \varepsilon_{it} $$
:::

## Which coefficient answers the research question?

$$ y_{it} = \beta \cdot WNS_{it} + \gamma X_{it} + \delta_t + \alpha_i + \varepsilon_{it} $$

A. $\beta$

B. $\gamma$

C. $\delta_t$

D. $\alpha_i$

## What is the role of $\alpha_i$ in the regression?

$$ y_{it} = \beta \cdot WNS_{it} + \gamma X_{it} + \delta_t + \alpha_i + \varepsilon_{it} $$

A. To capture the average treatment effect of white nose syndrome on ag land prices

B. To capture unobserved factors in a county that do not vary over time

C. To capture unobserved factors common to all counties at a given point in time

D. To control for federal agricultural policies that may change over time

# Results

## What is the effect of WNS on land rents?

![](includes/bats_tab_1.png)

## How might you visualize this result?

## Event study plot

![](includes/bats_event.png)

## Summarize the implications of the analysis?

iclicker
-->

# Course Review

## What was this course about?

## Topics and themes

- Effective and appropriate data visualizations

- Data storytelling

- Scripted data management and analysis (in R)


## Organization

- Time series

- Cross sectional and spatial data

- Panel data

What methods did we cover in these areas?



## What is the purpose of decomposing a time series into its components?

A. To remove any anomalies or outliers from the data.

B. To prepare the data for regression analysis.

C. To determine the forecast accuracy of the time series.

D. To identify the underlying patterns and relationships within the data.


## When is clustering analysis an appropriate technique for data analysis?

A. When the data is unlabeled or unstructured.

B. When the data has a clear target variable or outcome.

C. When the data has a linear relationship between variables.

D. When the data is in a time series format.


## Which of the following analysis techniques is regression *not* suitable for?

A. Time series analysis

B. Unsupervised learning

C. Supervised learning

D. Difference in differences


## How can color be used effectively in a data visualization?

A. To highlight important data points or trends.

B. To make the visualization more visually appealing.

C. To confuse the viewer with too many colors.

D. To distract from the key message of the visualization.



## What are your takeaways from the course?

:::{.incremental}
- Let the business or research question guide your analysis

- Once you have something to say, develop a compelling story

- Support your story with effective and appropriate visualizations 

:::



